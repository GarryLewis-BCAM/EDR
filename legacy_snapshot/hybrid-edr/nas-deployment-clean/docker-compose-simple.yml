version: '3.8'

services:
  # Ollama AI Engine
  ollama:
    image: ollama/ollama:latest
    container_name: edr-ollama
    volumes:
      - ollama-data:/root/.ollama
    ports:
      - "11434:11434"
    restart: unless-stopped

  # EDR Dashboard
  edr-dashboard:
    image: python:3.11-slim
    container_name: edr-dashboard
    working_dir: /app
    volumes:
      - edr-data:/app/data
      - ./utils:/app/utils:ro
      - ./config:/app/config:ro
    ports:
      - "5050:5050"
    command: >
      sh -c "pip install --quiet flask psutil pyyaml requests &&
             python3 -c 'from flask import Flask, jsonify, send_from_directory;
             app = Flask(__name__);
             @app.route(\"/\")
             def index(): return \"<h1>EDR Dashboard</h1><p>Waiting for collector to start...</p>\";
             @app.route(\"/health\")
             def health(): return jsonify({\"status\": \"ok\"});
             app.run(host=\"0.0.0.0\", port=5050)'"
    restart: unless-stopped

volumes:
  ollama-data:
  edr-data:
